<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Production Connection Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #ffffff;
        }
        .test-section {
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success { background: #0f5132; border: 1px solid #198754; }
        .error { background: #721c24; border: 1px solid #dc3545; }
        .info { background: #055160; border: 1px solid #0dcaf0; }
        button {
            background: #0d6efd;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .log {
            background: #000;
            color: #00ff00;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>üîß Chess Academy Production Connection Test</h1>

    <div class="test-section">
        <h2>üìã Test Configuration</h2>
        <p><strong>Frontend URL:</strong> <span id="frontend-url">Loading...</span></p>
        <p><strong>Backend URL:</strong> <span id="backend-url">Loading...</span></p>
        <p><strong>Environment:</strong> <span id="environment">Loading...</span></p>
    </div>

    <div class="test-section">
        <h2>üåê URL Accessibility Tests</h2>
        <button onclick="testFrontendURL()">Test Frontend URL</button>
        <button onclick="testBackendURL()">Test Backend URL</button>
        <button onclick="testMultiplayerURL()">Test Multiplayer URL</button>
        <button onclick="testStudyifyURL()">Test Studyify Domain</button>
        <div id="url-results"></div>
    </div>

    <div class="test-section">
        <h2>üîå Socket.IO Connection Test</h2>
        <button onclick="testSocketConnection()">Test Socket Connection</button>
        <button onclick="testAuthentication()">Test Authentication</button>
        <div id="socket-results"></div>
    </div>

    <div class="test-section">
        <h2>üìù Real-time Log</h2>
        <button onclick="clearLog()">Clear Log</button>
        <div id="log" class="log"></div>
    </div>

    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <script>
        // Configuration
        const PRODUCTION_FRONTEND = 'https://chess-academy-p1cte9v8r-kumaranandsinghs-projects.vercel.app';
        const BACKEND_URL = 'https://minimal-socket-server.vercel.app';
        const STUDYIFY_URL = 'https://studyify.in';

        let socket = null;

        // Logging
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.getElementById('log');
            const prefix = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : '‚ÑπÔ∏è';
            logElement.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }

        function clearLog() {
            document.getElementById('log').textContent = '';
        }

        function setStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('frontend-url').textContent = PRODUCTION_FRONTEND;
            document.getElementById('backend-url').textContent = BACKEND_URL;
            document.getElementById('environment').textContent = 'Production';

            log('üöÄ Production connection test initialized');
            log('Frontend: ' + PRODUCTION_FRONTEND);
            log('Backend: ' + BACKEND_URL);
        });

        // URL Accessibility Tests
        async function testFrontendURL() {
            log('üîç Testing frontend URL accessibility...');
            try {
                const response = await fetch(PRODUCTION_FRONTEND, {
                    method: 'HEAD',
                    mode: 'no-cors' // This will prevent CORS errors
                });
                log('‚úÖ Frontend URL is accessible (no-cors mode)', 'success');
                setStatus('url-results', '‚úÖ Frontend URL accessible', 'success');
            } catch (error) {
                log(`‚ùå Frontend URL test failed: ${error.message}`, 'error');
                setStatus('url-results', `‚ùå Frontend URL failed: ${error.message}`, 'error');
            }
        }

        async function testBackendURL() {
            log('üîç Testing backend URL accessibility...');
            try {
                const response = await fetch(BACKEND_URL);
                const data = await response.json();
                log(`‚úÖ Backend URL accessible - Status: ${data.status}, Connections: ${data.connections}`, 'success');
                setStatus('url-results', `‚úÖ Backend accessible - ${data.connections} connections`, 'success');
            } catch (error) {
                log(`‚ùå Backend URL test failed: ${error.message}`, 'error');
                setStatus('url-results', `‚ùå Backend URL failed: ${error.message}`, 'error');
            }
        }

        async function testMultiplayerURL() {
            log('üîç Testing multiplayer page URL...');
            try {
                const response = await fetch(PRODUCTION_FRONTEND + '/multiplayer', {
                    method: 'HEAD',
                    mode: 'no-cors'
                });
                log('‚úÖ Multiplayer URL is accessible (no-cors mode)', 'success');
                setStatus('url-results', '‚úÖ Multiplayer URL accessible', 'success');
            } catch (error) {
                log(`‚ùå Multiplayer URL test failed: ${error.message}`, 'error');
                setStatus('url-results', `‚ùå Multiplayer URL failed: ${error.message}`, 'error');
            }
        }

        async function testStudyifyURL() {
            log('üîç Testing studyify.in domain...');
            try {
                const response = await fetch(STUDYIFY_URL, {
                    method: 'HEAD',
                    mode: 'no-cors'
                });
                log('‚úÖ Studyify domain is accessible (no-cors mode)', 'success');
                setStatus('url-results', '‚úÖ Studyify domain accessible', 'success');
            } catch (error) {
                log(`‚ùå Studyify domain test failed: ${error.message}`, 'error');
                setStatus('url-results', `‚ùå Studyify domain failed: ${error.message}`, 'error');
            }
        }

        // Socket.IO Connection Tests
        function testSocketConnection() {
            log('üîå Testing Socket.IO connection...');

            if (socket) {
                socket.disconnect();
            }

            socket = io(BACKEND_URL, {
                transports: ['polling', 'websocket'],
                timeout: 20000,
                forceNew: true
            });

            socket.on('connect', () => {
                log(`‚úÖ Socket.IO connected! ID: ${socket.id}`, 'success');
                setStatus('socket-results', `‚úÖ Socket connected: ${socket.id}`, 'success');
            });

            socket.on('disconnect', (reason) => {
                log(`‚ùå Socket.IO disconnected: ${reason}`, 'error');
                setStatus('socket-results', `‚ùå Socket disconnected: ${reason}`, 'error');
            });

            socket.on('connect_error', (error) => {
                log(`‚ùå Socket.IO connection error: ${error.message}`, 'error');
                setStatus('socket-results', `‚ùå Connection error: ${error.message}`, 'error');
            });
        }

        function testAuthentication() {
            if (!socket || !socket.connected) {
                log('‚ùå Socket not connected. Connect first!', 'error');
                return;
            }

            log('üîê Testing authentication...');

            const userData = {
                userId: 'test-user-' + Date.now(),
                username: 'TestUser',
                rating: 1200
            };

            socket.once('authenticated', (data) => {
                log(`‚úÖ Authentication successful: ${JSON.stringify(data)}`, 'success');
                setStatus('socket-results', '‚úÖ Authentication successful', 'success');
            });

            socket.emit('authenticate', userData);
            log(`üîê Sent authentication with data: ${JSON.stringify(userData)}`);
        }

        // Auto-run basic tests
        setTimeout(() => {
            log('üîÑ Auto-running URL accessibility tests...');
            testBackendURL();
            setTimeout(testSocketConnection, 2000);
        }, 1000);
    </script>
</body>
</html>